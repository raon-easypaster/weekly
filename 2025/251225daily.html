<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>베들레헴 에브라다에 오신 왕: 성탄 주간 묵상</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #fdfcfb; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="text-slate-800 antialiased">
    <div class="min-h-screen p-4 md:p-8">
        <div class="max-w-2xl mx-auto">
            <!-- Header -->
            <header class="text-center mb-10">
                <h1 class="text-2xl md:text-3xl font-bold text-amber-900 mb-2 leading-tight">
                    베들레헴 에브라다에 오신 왕
                </h1>
                <p class="text-amber-700 font-medium bg-amber-50 inline-block px-4 py-1 rounded-full text-sm border border-amber-100">
                    성탄의 참된 의미를 찾아서
                </p>
            </header>

            <!-- Day Selector -->
            <div id="day-selector" class="flex justify-between items-center mb-8 overflow-x-auto pb-2 no-scrollbar gap-2">
                <!-- Days will be injected here by JS -->
            </div>

            <!-- Main Content Card -->
            <div class="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden transition-all duration-500">
                <!-- Card Header -->
                <div id="card-header" class="bg-amber-600 p-6 text-white relative">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-amber-200 text-xs font-black uppercase tracking-widest flex items-center gap-1">
                            <i data-lucide="calendar" class="w-3.5 h-3.5"></i> DAY <span id="display-day-number">1</span>
                        </span>
                        <button onclick="toggleComplete()" class="hover:scale-110 transition-transform focus:outline-none">
                            <div id="status-icon-container"></div>
                        </button>
                    </div>
                    <h2 id="display-title" class="text-xl md:text-2xl font-bold leading-snug"></h2>
                    <p class="mt-2 text-amber-100 italic flex items-center gap-2">
                        <i data-lucide="quote" class="w-3.5 h-3.5 rotate-180"></i> <span id="display-verse"></span>
                    </p>
                </div>

                <div class="p-6 space-y-8">
                    <!-- Reflection -->
                    <section>
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Reflection</h3>
                        <div class="bg-slate-50 p-5 rounded-2xl border-l-4 border-amber-400">
                            <p id="display-reflection" class="text-lg font-medium leading-relaxed italic text-slate-700"></p>
                        </div>
                    </section>

                    <!-- Action -->
                    <section>
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Today's Action</h3>
                        <div class="flex gap-4 items-start group cursor-pointer" onclick="toggleComplete()">
                            <div id="action-status-icon" class="mt-1 transition-colors"></div>
                            <p id="display-action" class="text-base leading-relaxed transition-all"></p>
                        </div>
                    </section>

                    <!-- Prayer -->
                    <section class="pt-6 border-t border-slate-50">
                        <h3 class="text-xs font-bold text-amber-500 uppercase tracking-wider mb-3 flex items-center gap-2">
                            <i data-lucide="heart" class="w-3.5 h-3.5"></i> Prayer
                        </h3>
                        <p id="display-prayer" class="text-slate-600 italic leading-relaxed"></p>
                    </section>

                    <!-- AI Section -->
                    <div class="pt-4" id="ai-section">
                        <div id="ai-result-container" class="hidden bg-amber-50 p-5 rounded-2xl border border-amber-100 text-slate-700 text-sm leading-relaxed animate-in fade-in slide-in-from-bottom-2 mb-4">
                            <div class="font-bold text-amber-800 mb-2 flex items-center gap-2">
                                <i data-lucide="message-circle" class="w-4 h-4"></i> 깊은 묵상을 위한 도우미 (AI)
                            </div>
                            <div id="ai-text" class="whitespace-pre-wrap leading-relaxed"></div>
                            <button onclick="hideAi()" class="mt-4 text-xs text-amber-600 font-bold hover:underline">닫기</button>
                        </div>

                        <button id="ai-button" onclick="handleAiRequest()" class="w-full py-4 rounded-2xl border-2 border-dashed border-slate-200 text-slate-400 hover:border-amber-300 hover:text-amber-600 transition-all flex items-center justify-center gap-2 font-medium">
                            <i data-lucide="sparkles" class="w-4 h-4"></i>
                            <span id="ai-button-text">주제에 대해 더 깊이 묵상하기</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex justify-between items-center mt-8 px-2">
                <button id="prev-btn" onclick="prevDay()" class="flex items-center gap-1 text-sm font-bold text-amber-700 hover:translate-x-[-4px] transition-transform disabled:text-slate-300 disabled:hover:translate-x-0">
                    <i data-lucide="chevron-left" class="w-5 h-5"></i> 이전 날
                </button>
                
                <div class="text-xs font-bold text-slate-400 bg-white px-3 py-1 rounded-full border border-slate-100 shadow-sm">
                    <span id="current-step">1</span> / 7
                </div>

                <button id="next-btn" onclick="nextDay()" class="flex items-center gap-1 text-sm font-bold text-amber-700 hover:translate-x-[4px] transition-transform disabled:text-slate-300 disabled:hover:translate-x-0">
                    다음 날 <i data-lucide="chevron-right" class="w-5 h-5"></i>
                </button>
            </div>

            <footer class="mt-16 text-center text-slate-400 text-xs pb-10">
                <p>© 2024 라온동행교회 주간 묵상집</p>
                <p class="mt-1 font-medium">작은 자로 오신 왕을 찬양합니다</p>
            </footer>
        </div>
    </div>

    <script>
        // --- Data ---
        const devotionalData = [
            { day: 1, title: "먼저 찾아오시는 하나님의 선행적 은총", verse: "미가 5:2", reflection: "베들레헴처럼 작고 보잘것없는 나의 마음에 하나님께서 먼저 찾아오셨음을 느낀 적이 있나요? 우리가 하나님을 알기도 전에 먼저 사랑하신 그 은혜를 깊이 묵상해 봅시다.", action: "오늘 하루, 나의 조건이나 공로가 아니라 하나님의 전적인 사랑으로 내가 선택받았음을 고백하며 '하나님, 저를 먼저 사랑해 주셔서 감사합니다'라고 세 번 진심을 담아 선포하세요.", prayer: "사랑의 주님, 자격 없는 저를 먼저 사랑하시고 제 삶의 베들레헴에 찾아와 주셔서 감사합니다. 오늘 그 선행적 은총에 기대어 기쁨으로 하루를 시작하게 하소서." },
            { day: 2, title: "작은 것에서 시작되는 성결의 은총", verse: "미가 5:2", reflection: "유다 족속 중 가장 작은 베들레헴을 택하신 하나님은 오늘 우리의 소박한 순종을 기뻐하십니다. 오늘 내가 주님 앞에서 거룩하게 구별해야 할 작은 습관이나 언어는 무엇인가요?", action: "내 삶에서 무심코 지나쳤던 사소한 불평이나 습관 하나를 정하여, 오늘 하루는 그것을 멈추고 대신 감사의 말을 그 자리에 심어보세요.", prayer: "주님, 화려한 도시가 아닌 작은 마을에 오신 주님을 닮기 원합니다. 제 작은 일상의 순간들이 주님의 거룩함을 드러내는 거룩한 베들레헴이 되게 하소서." },
            { day: 3, title: "메마른 마음을 적시는 성육신의 사랑", verse: "미가 5:3", reflection: "분주함과 삶의 무게로 팍팍해진 내 마음에 주님은 여전히 따뜻하게 찾아오고 계십니다. 주님이 내 마음에 오셔서 어루만져 주시고 회복시켜 주시기를 바라는 아픔이나 결핍은 무엇인가요?", action: "오늘 조용한 시간에 5분간 머물며, 예수님이 이 땅에 오신 의미를 생각하며 주님이 나의 상처를 따뜻하게 안아주시는 평안의 시간을 가지세요.", prayer: "메마른 땅에 단비처럼 오신 예수님, 지치고 상한 제 마음을 주님의 성육신하신 사랑으로 위로하여 주시고 다시 일어설 영적인 힘을 공급하여 주옵소서." },
            { day: 4, title: "사회적 성결: 소외된 베들레헴을 찾아서", verse: "미가 5:4", reflection: "예수님은 세상의 중심이 아닌 변두리에서 탄생하셨습니다. 우리 주변에 베들레헴처럼 사람들의 관심에서 멀어져 소외된 이웃은 누구인가요? 그들에게 어떻게 주님의 사랑을 구체적으로 흘려보낼 수 있을까요?", action: "평소 연락이 뜸했거나 외로워 보이는 지인에게 따뜻한 격려의 메시지를 보내거나 작은 정성을 나누며 성탄의 기쁨을 함께 나누세요.", prayer: "낮은 곳으로 임하신 주님, 제가 제 삶의 안위만 돌보지 않게 하시고 주님의 시선이 머무는 소외된 곳에 제 발걸음과 마음도 머물게 하소서." },
            { day: 5, title: "내 삶의 중심에 예수님 모시기", verse: "요한복음 1:46", reflection: "나다나엘처럼 혹시 '내 삶의 초라한 형편에서 무슨 선한 것이 나겠어?'라며 주님의 능력을 제한하고 있지는 않나요? 내 삶의 모든 영역에 주님을 진정한 주인으로 모셔드리고 있습니까?", action: "오늘 마주하는 결정의 순간마다 '주님이라면 어떻게 하셨을까?'를 먼저 질문하고, 내 욕심이 아닌 주님이 기뻐하시는 방향으로 한 가지만 결정해 보세요.", prayer: "주님, 제 편견과 불신을 내려놓습니다. 보잘것없는 제 삶의 주권자가 되어 주셔서 오직 주님만이 영광 받으시는 복된 삶이 되게 하소서." },
            { day: 6, title: "완전한 사랑으로 나아가는 길", verse: "미가 5:4", reflection: "여호와의 위엄을 의지하여 선한 목자가 되신 예수님은 우리를 완전한 사랑의 상태로 인도하십니다. 나는 오늘 그분의 인도하심을 온전히 신뢰하며 내 삶을 맡기고 있나요?", action: "혼자 힘으로 해결하려 애쓰던 걱정거리를 하나 정하여, 오늘 하루는 주님께 온전히 맡겨드리고 주님이 주시는 평안 속에서 안식해 보세요.", prayer: "선한 목자 되신 주님, 주님의 위엄과 사랑 안에서 참된 안식을 누립니다. 저를 온전한 사랑과 성결의 길로 매일매일 인도하여 주옵소서." },
            { day: 7, title: "기억하고 전파하는 성탄의 증인", verse: "미가 5:4", reflection: "성탄은 과거의 박제된 사건이 아니라 오늘 우리 삶에서 생생하게 재현되어야 할 복음입니다. 한 주간 묵상한 성탄의 의미를 누구에게, 어떤 삶의 모습으로 증거하시겠습니까?", action: "성탄의 기쁨을 담은 나만의 짧은 감사 고백을 적어보고, 가족이나 친구에게 공유하며 주님이 오신 소식을 축하하는 시간을 가지세요.", prayer: "영원부터 계셨고 우리를 위해 오신 주님, 성탄의 소식이 제 삶의 끊이지 않는 노래가 되게 하소서. 세상 끝까지 주님의 사랑을 전하는 성탄의 통로로 살게 하소서." }
        ];

        // --- State ---
        let currentDayIdx = 0;
        let completedDays = new Array(7).fill(false);
        const apiKey = ""; // API Key used by execution environment

        // --- Core Functions ---
        function init() {
            renderDaySelector();
            updateContent();
            lucide.createIcons();
        }

        function renderDaySelector() {
            const container = document.getElementById('day-selector');
            container.innerHTML = '';
            devotionalData.forEach((d, idx) => {
                const btn = document.createElement('button');
                btn.innerText = d.day;
                btn.onclick = () => setDay(idx);
                
                const isCurrent = currentDayIdx === idx;
                const isCompleted = completedDays[idx];
                
                let classes = "flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all duration-300 ";
                if (isCurrent) {
                    classes += "bg-amber-600 text-white shadow-lg scale-110";
                } else if (isCompleted) {
                    classes += "bg-amber-100 text-amber-600 border border-amber-200";
                } else {
                    classes += "bg-white text-slate-400 border border-slate-200 hover:border-amber-300";
                }
                
                btn.className = classes;
                container.appendChild(btn);
            });
        }

        function updateContent() {
            const data = devotionalData[currentDayIdx];
            const isCompleted = completedDays[currentDayIdx];

            document.getElementById('display-day-number').innerText = data.day;
            document.getElementById('display-title').innerText = data.title;
            document.getElementById('display-verse').innerText = data.verse;
            document.getElementById('display-reflection').innerText = `"${data.reflection}"`;
            document.getElementById('display-action').innerText = data.action;
            document.getElementById('display-prayer').innerText = data.prayer;
            document.getElementById('current-step').innerText = data.day;

            // Status Icon (Top)
            const statusIconContainer = document.getElementById('status-icon-container');
            statusIconContainer.innerHTML = isCompleted 
                ? '<i data-lucide="check-circle-2" class="w-6 h-6 text-amber-200"></i>' 
                : '<i data-lucide="circle" class="w-6 h-6 text-amber-200 opacity-50"></i>';

            // Action Status (Bottom)
            const actionStatusIcon = document.getElementById('action-status-icon');
            actionStatusIcon.innerHTML = isCompleted 
                ? '<i data-lucide="check-circle-2" class="w-6 h-6 text-green-500"></i>' 
                : '<i data-lucide="check-circle-2" class="w-6 h-6 text-slate-300"></i>';

            const actionText = document.getElementById('display-action');
            if (isCompleted) {
                actionText.classList.add('text-slate-400', 'line-through');
            } else {
                actionText.classList.remove('text-slate-400', 'line-through');
                actionText.classList.add('text-slate-800');
            }

            // Buttons state
            document.getElementById('prev-btn').disabled = currentDayIdx === 0;
            document.getElementById('next-btn').disabled = currentDayIdx === 6;

            hideAi();
            lucide.createIcons();
        }

        function setDay(idx) {
            currentDayIdx = idx;
            renderDaySelector();
            updateContent();
        }

        function nextDay() { if (currentDayIdx < 6) setDay(currentDayIdx + 1); }
        function prevDay() { if (currentDayIdx > 0) setDay(currentDayIdx - 1); }

        function toggleComplete() {
            completedDays[currentDayIdx] = !completedDays[currentDayIdx];
            renderDaySelector();
            updateContent();
        }

        // --- AI Logic ---
        function hideAi() {
            document.getElementById('ai-result-container').classList.add('hidden');
            document.getElementById('ai-button').classList.remove('hidden');
        }

        async function handleAiRequest() {
            const btn = document.getElementById('ai-button');
            const btnText = document.getElementById('ai-button-text');
            const resultContainer = document.getElementById('ai-result-container');
            const aiText = document.getElementById('ai-text');
            const data = devotionalData[currentDayIdx];

            btn.disabled = true;
            btnText.innerText = "묵상을 준비하고 있습니다...";
            btn.classList.add('animate-pulse');

            const userQuery = `성경 구절 ${data.verse}와 주제 '${data.title}'에 대해 오늘날 우리가 실천할 수 있는 더 깊은 영적 의미와 묵상 포인트를 3가지 알려줘.`;
            const systemPrompt = "당신은 따뜻하고 지혜로운 신학자이자 목회자입니다. 사용자에게 성경의 깊은 의미를 친절하게 설명해주세요. 답변은 한국어로 해주세요.";

            try {
                let delay = 1000;
                let success = false;
                for (let i = 0; i < 5; i++) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: userQuery }] }],
                                systemInstruction: { parts: [{ text: systemPrompt }] }
                            })
                        });
                        const result = await response.json();
                        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        if (text) {
                            aiText.innerText = text;
                            success = true;
                            break;
                        }
                    } catch (e) {
                        if (i === 4) throw e;
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2;
                    }
                }
                
                if (success) {
                    resultContainer.classList.remove('hidden');
                    btn.classList.add('hidden');
                } else {
                    throw new Error("No text returned");
                }

            } catch (error) {
                console.error(error);
                alert("묵상을 불러오는 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.");
            } finally {
                btn.disabled = false;
                btnText.innerText = "주제에 대해 더 깊이 묵상하기";
                btn.classList.remove('animate-pulse');
                lucide.createIcons();
            }
        }

        window.onload = init;
    </script>
</body>
</html>
